# 图片加水印工具需求文档

## 1. 项目概述

本项目旨在开发一个实用工具，可以批量为图片添加基于拍摄日期的文本水印。用户可以自定义水印的样式和位置，方便地为自己的摄影作品集添加统一标识。

## 2. 功能需求

### 2.1 核心功能

- **批量处理**: 支持一次性处理指定文件夹内的所有图片。
- **自动读取拍摄日期**:
    - 程序自动读取图片文件 EXIF 信息中的 `DateTimeOriginal` (拍摄时间) 标签。
    - 提取该时间的年月日（格式：YYYY-MM-DD）作为水印内容。
- **文本水印生成**: 将提取的日期文本绘制到图片上。
- **文件输出**:
    - 处理后的图片将保存为新文件，以避免覆盖原始图片。
    - 所有新文件存储在原文件夹内的一个新建子目录中，命名为 `原目录名_watermark`。

### 2.2 水印自定义选项

用户可以对水印进行以下参数的自定义设置：

- **位置 (Position)**:
    - 提供九宫格位置选项：左上、中上、右上、左中、居中、右中、左下、中下、右下。
    - 默认位置：右下角。
- **字体 (Font)**:
    - 用户可以指定字体文件的路径（.ttf, .otf）。
    - 如果不指定，则使用程序内置的默认字体。
- **字体大小 (Font Size)**:
    - 用户可以设置一个整数值来定义字体大小。
    - 程序应能根据图片尺寸自适应调整字体大小的相对比例。
- **颜色 (Color)**:
    - 用户可以通过十六进制颜色码（如 `#FFFFFF`）或常见颜色名称（如 `white`）来指定字体颜色。
    - 默认颜色：白色。
- **透明度 (Opacity)**:
    - 用户可以设置水印的透明度（范围 0.0 到 1.0）。
    - 1.0 表示完全不透明，0.0 表示完全透明。
    - 默认值：0.7。
- **边距 (Margin)**:
    - 用户可以设置水印距离图片边缘的像素值。
    - 默认值：10 像素。

### 2.3 支持格式

- **输入图片格式**: 支持常见的图片格式，如 `JPEG`, `PNG`。
- **输出图片格式**: 输出格式与输入格式保持一致。

## 3. 非功能性需求

- **用户界面 (UI)**:
    - 初期版本为命令行界面（CLI）工具。
    - 所有自定义选项通过命令行参数传入。
- **性能**:
    - 程序应在合理时间内完成处理，避免长时间无响应。
    - 显示处理进度，例如 `正在处理第 x/y 张图片...`。
- **错误处理**:
    - **无效路径**: 如果用户输入的文件夹路径不存在，程序应提示错误并退出。
    - **无图片文件**: 如果指定文件夹内不包含支持的图片格式，程序应提示信息并退出。
    - **EXIF 信息缺失**: 如果某张图片没有 EXIF 拍摄日期信息，程序应跳过该文件，并给出明确的日志提示。
    - **文件读写权限**: 如果程序没有权限读取源文件或写入目标目录，应提示权限错误。
- **兼容性**:
    - 支持在 Windows, macOS 和 Linux 系统上运行。

## 4. 命令行接口（CLI）设计示例

```bash
add-watermark --source "D:\Photos\TripToParis" --size 36 --color "#FFFFFF" --position "bottom-right" --opacity 0.8
```

- `--source` (或 `-s`): **必需**。源图片文件夹路径。
- `--font` (或 `-f`): *可选*。字体文件路径。
- `--size` (或 `-sz`): *可选*。字体大小。
- `--color` (或 `-c`): *可选*。字体颜色。
- `--position` (或 `-p`): *可选*。水印位置。
- `--opacity` (或 `-o`): *可选*。透明度。
- `--margin` (或 `-m`): *可选*。边距。

## 5. 未来可能的功能扩展

- 支持图形用户界面（GUI）。
- 支持自定义文本水印内容。
- 支持图片水印。
- 支持递归遍历子文件夹。
- 支持在添加水印前预览效果。
